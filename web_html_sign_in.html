<!DOCTYPE html>
<html lang="he">
<head>
  <meta charset="UTF-8">
  <title>Login Box</title>
  <!-- קישור ל־CSS חיצוני -->
  <link rel="stylesheet" href="web_css_sign_in.css">
</head>
<body>

    <div class="login-box">
      <h2>Sign In</h2>
      <!-- הטופס הקיים -->
      <form action="/login" method="post">
        <input type="text" name="username" placeholder="Username" required>
        <input type="password" name="password" placeholder="Password" required>
        <button type="submit">Sign In</button>
      </form>

      <!-- כפתור Google Sign In -->
      <div id="google-signin-button"></div>
    </div>

    <!-- 1. טען את הספרייה של Google Identity Services -->
    <script src="https://accounts.google.com/gsi/client" async defer></script>

    <!-- 2. הגדר את ה-callback שתטפל במידע -->
    <script>
      function handleCredentialResponse(response) {
        // response.credential מכיל את ה-ID token (JWT)
        // נשלח לשרת כדי לאמת וליצור סשן
        fetch('/gcallback', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ credential: response.credential })
        })
        .then(r => r.json())
        .then(data => {
          if (data.success) {
            window.location.href = '/dashboard';  // או כל דף אחר
          } else {
            alert('Login failed');
          }
        });
      }

      window.onload = () => {
        google.accounts.id.initialize({
          client_id: 'YOUR_CLIENT_ID_HERE',
          callback: handleCredentialResponse
        });
        google.accounts.id.renderButton(
          document.getElementById('google-signin-button'),
          { theme: 'outline', size: 'large', text: 'signin_with' }
        );
      };
    </script>

</body>
</html>
